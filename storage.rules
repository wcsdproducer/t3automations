rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    /**
     * @description This rule secures the multi-tenant storage structure. It grants a
     *              user read and write access to all files and folders within their own
     *              directory, identified by their UID, under the top-level 'Clients' folder.
     *              This is a robust, recursive rule that ensures user data privacy.
     * @path /Clients/{userId}/{allPaths=**}
     *
     * @example_allow
     * // User 'user-123' uploads a file:
     * // /Clients/user-123/some-file.pdf
     * // The {userId} wildcard matches 'user-123'.
     * // The rule `request.auth.uid == userId` passes.
     *
     * @example_deny
     * // User 'user-123' attempts to access another user's files:
     * // /Clients/user-456/some-file.pdf
     * // The {userId} wildcard matches 'user-456'.
     * // The rule `request.auth.uid == userId` fails.
     */
    match /Clients/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
